# Сервис обмена

Этот проект реализует сервис кошельков с возможностью пополнения и снятия средств, используя **Spring Boot**, **WebFlux**,
**R2DBC** для асинхронного взаимодействия с базой данных и **Liquibase** для миграций базы данных. Приложение
работает внутри Docker-контейнеров, с использованием PostgreSQL в качестве базы данных.

## Функции

Для миграции используется **Liquibase**.
Эндпоинт **/api/v1/wallet** позволяет выполнить операцию пополнения или снятия средств с кошелька. Ожидается следующее
тело запроса:
```json
{
  "walletId": "UUID",
  "operationType": "WITHDRAW or DEPOSIT",
  "amount": "NUMBER"
}
```

Эндпоинт **/wallets/{walletId}** позволяет узнать текущий баланс кошелька. Ожидаемый ответ:

```json
{
"balance": 1000.0
}
```

При отправке некорректных данных или запросе невалидной операции будет возвращена соответствующая ошибка. Например:

```json
{
"errorCode": "INSUFFICIENT_FUNDS",
"errorMessage": "Недостаточно средств"
}
```

В docker-compose.yml предусмотрены переменные окружения для настройки контейнеров, включая параметры подключения к БД,
файл миграций и другие настройки.

## Технологии

Мы использовали Spring Boot как основной фреймворк с помощью следующих технологий:

- **Spring WebFlux** - для обеспечения реактивных запросов
- **R2DBC** - для реактивного доступа к базе данных
- **Liquibase** - для управления миграциями базы данных
- **Mockito** - для создания моков зависимостей при тестировании
- в качестве БД использовалась **PostgreSQL**

## Необходимые инструменты

Прежде чем запустить приложение, убедитесь, что у вас установлены следующие инструменты:

- **Docker** и **Docker Compose**: Для сборки и запуска контейнеров
- **Java 17** (или совместимая версия): Для сборки и запуска приложения Spring Boot
- **Maven**: Для сборки приложения

## Начало работы

### Клонируйте репозиторий

```bash
git clone <repository-url>
cd <project-directory>
```

### Сборка и запуск

Приложение работает в docker, но перед этим нужно собрать образ из DockerFile. Для этого достаточно выполнить команду:

```bash
git clone <repository-url>
docker-compose up --build
```

### Использование переменных окружения

- **R2DBC_URL** - URL подключения к базе данных через R2DBC.
- **R2DBC_USERNAME** и R2DBC_PASSWORD - учетные данные для подключения
- **LIQUIBASE_URL** - JDBC URL для Liquibase
- **LIQUIBASE_DROP_FIRST** - удаляет схему в БД. По умолчанию true